<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Side Scroller</title>

<style>
    body {
        margin: 0;
        background: black;
        overflow: hidden;
    }

    canvas {
        display: block;
        margin: auto;
        background: #000;
    }
</style>
</head>

<body>

<canvas id="game" width="960" height="540"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ---------------- SETTINGS ----------------
const WIDTH = canvas.width;
const HEIGHT = canvas.height;
const GROUND = HEIGHT - 80;
const GRAVITY = 0.6;
const keys = {};

// ---------------- LOAD IMAGES ----------------
const background = new Image();
background.src = "assets/background.png";

const playerSprites = {
    idle: new Image(),
    up: new Image(),
    down: new Image(),
    left: new Image(),
    right: new Image()
};

playerSprites.idle.src = "assets/player_idle.png";
playerSprites.up.src = "assets/player_up.png";
playerSprites.down.src = "assets/player_down.png";
playerSprites.left.src = "assets/player_left.png";
playerSprites.right.src = "assets/player_right.png";

const bossImage = new Image();
bossImage.src = "assets/boss.png";

// ---------------- PLAYER ----------------
const player = {
    x: 150,
    y: GROUND - 64,
    width: 64,
    height: 64,
    speed: 5,

    vy: 0,
    jumping: false,

    sprite: playerSprites.idle,
    attacking: false,
    attackCooldown: 0
};

// ---------------- BOSS ----------------
const boss = {
    x: 700,
    y: GROUND - 96,
    width: 96,
    height: 96,
    health: 100,
    maxHealth: 100
};

// ---------------- INPUT ----------------
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// ---------------- ATTACK HITBOX ----------------
function getAttackBox() {
    const size = 40;

    if (!player.attacking) return null;

    if (player.sprite === playerSprites.right)
        return { x: player.x + player.width, y: player.y + 10, w: size, h: size };

    if (player.sprite === playerSprites.left)
        return { x: player.x - size, y: player.y + 10, w: size, h: size };

    if (player.sprite === playerSprites.up)
        return { x: player.x + 10, y: player.y - size, w: size, h: size };

    if (player.sprite === playerSprites.down)
        return { x: player.x + 10, y: player.y + player.height, w: size, h: size };

    return null;
}

// ---------------- COLLISION ----------------
function rectsOverlap(a, b) {
    return (
        a.x < b.x + b.width &&
        a.x + a.w > b.x &&
        a.y < b.y + b.height &&
        a.y + a.h > b.y
    );
}

// ---------------- UPDATE ----------------
function update() {

    // Horizontal movement
    if (keys["a"] || keys["A"]) player.x -= player.speed;
    if (keys["d"] || keys["D"]) player.x += player.speed;

    // Jump
    if ((keys["w"] || keys[" "] ) && !player.jumping) {
        player.vy = -12;
        player.jumping = true;
    }

    // Gravity
    player.vy += GRAVITY;
    player.y += player.vy;

    if (player.y >= GROUND - player.height) {
        player.y = GROUND - player.height;
        player.vy = 0;
        player.jumping = false;
    }

    // Attack cooldown
    if (player.attackCooldown > 0) player.attackCooldown--;

    player.attacking = false;

    if (player.attackCooldown === 0) {
        if (keys["ArrowUp"]) {
            player.sprite = playerSprites.up;
            player.attacking = true;
        }
        else if (keys["ArrowDown"]) {
            player.sprite = playerSprites.down;
            player.attacking = true;
        }
        else if (keys["ArrowLeft"]) {
            player.sprite = playerSprites.left;
            player.attacking = true;
        }
        else if (keys["ArrowRight"]) {
            player.sprite = playerSprites.right;
            player.attacking = true;
        }
        else {
            player.sprite = playerSprites.idle;
        }
    }

    // Hit detection
    const attackBox = getAttackBox();
    if (attackBox && boss.health > 0) {
        if (rectsOverlap(attackBox, boss)) {
            boss.health -= 1;
            player.attackCooldown = 15;
        }
    }
}

// ---------------- DRAW ----------------
function draw() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT);

    ctx.drawImage(background, 0, 0, WIDTH, HEIGHT);

    // Boss
    if (boss.health > 0) {
        ctx.drawImage(bossImage, boss.x, boss.y, boss.width, boss.height);

        // Boss health bar
        ctx.fillStyle = "red";
        ctx.fillRect(boss.x, boss.y - 10, boss.width, 6);
        ctx.fillStyle = "lime";
        ctx.fillRect(boss.x, boss.y - 10, boss.width * (boss.health / boss.maxHealth), 6);
    }

    // Player
    ctx.drawImage(player.sprite, player.x, player.y, player.width, player.height);

    // Debug attack box (optional)
    const box = getAttackBox();
    if (box) {
        ctx.strokeStyle = "yellow";
        ctx.strokeRect(box.x, box.y, box.w, box.h);
    }
}

// ---------------- GAME LOOP ----------------
function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
